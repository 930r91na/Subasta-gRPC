<!DOCTYPE html>
<html>
<head>
    <title>Live Auction</title>
    <style>
        body { font-family: Arial; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .product { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .bid-button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .price { font-size: 24px; font-weight: bold; color: #2196F3; }
    </style>
</head>
<body>
    <h1>ðŸ”¨ Live Auction System</h1>
    
    <div id="userSection">
        <input type="text" id="username" placeholder="Your name">
        <button onclick="registerUser()">Register</button>
        <span id="userStatus"></span>
    </div>

    <h2>Active Auctions</h2>
    <div id="products"></div>

    <h2>Recent Bids</h2>
    <div id="bidHistory"></div>

    <script>
        let currentUser = '';
        const API_URL = 'http://localhost:8080'; // gRPC-Web proxy

        async function registerUser() {
            const username = document.getElementById('username').value;
            
            try {
                const response = await fetch(`${API_URL}/auction.AuctionService/RegisterUser`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({name: username})
                });
                
                const data = await response.json();
                if (data.success) {
                    currentUser = username;
                    document.getElementById('userStatus').textContent = 'âœ“ Logged in as ' + username;
                    loadCatalog();
                }
            } catch (err) {
                console.error('Error:', err);
            }
        }

        async function loadCatalog() {
            try {
                const response = await fetch(`${API_URL}/auction.AuctionService/GetCatalog`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                displayProducts(data.products || []);
            } catch (err) {
                console.error('Error:', err);
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('products');
            container.innerHTML = '';
            
            products.forEach(product => {
                const div = document.createElement('div');
                div.className = 'product';
                div.innerHTML = `
                    <h3>${product.product}</h3>
                    <p>Seller: ${product.seller}</p>
                    <p class="price">Current: $${product.current_price.toFixed(2)}</p>
                    <input type="number" id="bid-${product.product}" 
                           placeholder="Your bid" min="${product.current_price + 1}">
                    <button class="bid-button" onclick="placeBid('${product.product}')">
                        Place Bid
                    </button>
                `;
                container.appendChild(div);
            });
        }

        async function placeBid(productName) {
            const amount = parseFloat(document.getElementById(`bid-${productName}`).value);
            
            try {
                const response = await fetch(`${API_URL}/auction.AuctionService/PlaceBid`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        buyer: currentUser,
                        product: productName,
                        amount: amount
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('âœ“ Bid accepted!');
                    loadCatalog();
                } else {
                    alert('âœ— ' + data.message);
                }
            } catch (err) {
                console.error('Error:', err);
            }
        }

        // Auto-refresh every 3 seconds
        setInterval(() => {
            if (currentUser) loadCatalog();
        }, 3000);
    </script>
</body>
</html>